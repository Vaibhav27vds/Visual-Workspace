{
  "version": 3,
  "sources": ["../../../../src/cli/lib/usage.ts"],
  "sourcesContent": ["import chalk from \"chalk\";\nimport { Context, logWarning } from \"../../bundler/context.js\";\nimport { dashboardUrl } from \"../dashboard.js\";\nimport { fetchTeamAndProject } from \"./api.js\";\nimport {\n  bigBrainAPI,\n  getAuthHeaderFromGlobalConfig,\n  getConfiguredDeployment,\n  getConfiguredDeploymentOrCrash,\n} from \"./utils.js\";\n\nasync function warn(ctx: Context, title: string, subtitle: string) {\n  const configuredDeployment = await getConfiguredDeploymentOrCrash(ctx);\n  const { team } = await fetchTeamAndProject(ctx, configuredDeployment);\n\n  logWarning(ctx, chalk.bold.yellow(title));\n  logWarning(ctx, chalk.yellow(subtitle));\n  logWarning(\n    ctx,\n    chalk.yellow(`Visit ${dashboardUrl(team, null, null)} to learn more.`)\n  );\n}\n\nasync function teamUsageState(ctx: Context) {\n  const configuredDeployment = await getConfiguredDeployment(ctx);\n  if (configuredDeployment === null) {\n    return null;\n  }\n\n  const { teamId } = await fetchTeamAndProject(ctx, configuredDeployment);\n\n  const { usageState } = (await bigBrainAPI({\n    ctx,\n    method: \"GET\",\n    url: \"/dashboard/teams/\" + teamId + \"/usage/team_usage_state\",\n  })) as {\n    usageState: \"Default\" | \"Approaching\" | \"Exceeded\" | \"Disabled\" | \"Paused\";\n  };\n\n  return usageState;\n}\n\nexport async function usageStateWarning(ctx: Context) {\n  // Skip the warning if the user doesn\u2019t have an auth token\n  // (which can happen for instance when using a deploy key)\n  const authHeader = await getAuthHeaderFromGlobalConfig(ctx);\n  if (authHeader === null) {\n    return;\n  }\n\n  const usageState = await teamUsageState(ctx);\n\n  if (usageState === \"Approaching\") {\n    await warn(\n      ctx,\n      \"Your projects are approaching the Starter plan limits.\",\n      \"Consider upgrading to avoid service interruption.\"\n    );\n  } else if (usageState === \"Exceeded\") {\n    await warn(\n      ctx,\n      \"Your projects are above the Starter plan limits.\",\n      \"Decrease your usage or upgrade to avoid service interruption.\"\n    );\n  } else if (usageState === \"Disabled\") {\n    await warn(\n      ctx,\n      \"Your projects are disabled because the team exceeded Starter plan limits.\",\n      \"Decrease your usage or upgrade to reenable your projects.\"\n    );\n  } else if (usageState === \"Paused\") {\n    await warn(\n      ctx,\n      \"Your projects are disabled because the team previously exceeded Starter plan limits.\",\n      \"Restore your projects by going to the dashboard.\"\n    );\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,qBAAoC;AACpC,uBAA6B;AAC7B,iBAAoC;AACpC,mBAKO;AAEP,eAAe,KAAK,KAAc,OAAe,UAAkB;AACjE,QAAM,uBAAuB,UAAM,6CAA+B,GAAG;AACrE,QAAM,EAAE,KAAK,IAAI,UAAM,gCAAoB,KAAK,oBAAoB;AAEpE,iCAAW,KAAK,aAAAA,QAAM,KAAK,OAAO,KAAK,CAAC;AACxC,iCAAW,KAAK,aAAAA,QAAM,OAAO,QAAQ,CAAC;AACtC;AAAA,IACE;AAAA,IACA,aAAAA,QAAM,OAAO,aAAS,+BAAa,MAAM,MAAM,IAAI,kBAAkB;AAAA,EACvE;AACF;AAEA,eAAe,eAAe,KAAc;AAC1C,QAAM,uBAAuB,UAAM,sCAAwB,GAAG;AAC9D,MAAI,yBAAyB,MAAM;AACjC,WAAO;AAAA,EACT;AAEA,QAAM,EAAE,OAAO,IAAI,UAAM,gCAAoB,KAAK,oBAAoB;AAEtE,QAAM,EAAE,WAAW,IAAK,UAAM,0BAAY;AAAA,IACxC;AAAA,IACA,QAAQ;AAAA,IACR,KAAK,sBAAsB,SAAS;AAAA,EACtC,CAAC;AAID,SAAO;AACT;AAEA,eAAsB,kBAAkB,KAAc;AAGpD,QAAM,aAAa,UAAM,4CAA8B,GAAG;AAC1D,MAAI,eAAe,MAAM;AACvB;AAAA,EACF;AAEA,QAAM,aAAa,MAAM,eAAe,GAAG;AAE3C,MAAI,eAAe,eAAe;AAChC,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,WAAW,eAAe,YAAY;AACpC,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,WAAW,eAAe,YAAY;AACpC,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,WAAW,eAAe,UAAU;AAClC,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACF;",
  "names": ["chalk"]
}
