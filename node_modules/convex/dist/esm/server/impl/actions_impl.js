"use strict";
import { convexToJson, jsonToConvex } from "../../values/index.js";
import { version } from "../../index.js";
import { performAsyncSyscall } from "./syscall.js";
import { parseArgs } from "../../common/index.js";
import { getFunctionName } from "../../server/api.js";
export function setupActionCalls(requestId) {
  return {
    runQuery: async (query, args) => {
      const name = getFunctionName(query);
      const queryArgs = parseArgs(args);
      const syscallArgs = {
        name,
        args: convexToJson(queryArgs),
        version,
        requestId
      };
      const result = await performAsyncSyscall(
        "1.0/actions/query",
        syscallArgs
      );
      return jsonToConvex(result, false);
    },
    runMutation: async (mutation, args) => {
      const name = getFunctionName(mutation);
      const mutationArgs = parseArgs(args);
      const syscallArgs = {
        name,
        args: convexToJson(mutationArgs),
        version,
        requestId
      };
      const result = await performAsyncSyscall(
        "1.0/actions/mutation",
        syscallArgs
      );
      return jsonToConvex(result, false);
    },
    runAction: async (action, args) => {
      const name = getFunctionName(action);
      const actionArgs = parseArgs(args);
      const syscallArgs = {
        name,
        args: convexToJson(actionArgs),
        version,
        requestId
      };
      const result = await performAsyncSyscall(
        "1.0/actions/action",
        syscallArgs
      );
      return jsonToConvex(result, false);
    }
  };
}
//# sourceMappingURL=actions_impl.js.map
