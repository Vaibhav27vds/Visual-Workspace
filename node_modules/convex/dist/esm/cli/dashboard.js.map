{
  "version": 3,
  "sources": ["../../../src/cli/dashboard.ts"],
  "sourcesContent": ["import { Command } from \"commander\";\nimport chalk from \"chalk\";\nimport {\n  ProjectConfig,\n  enforceDeprecatedConfigField,\n  readProjectConfig,\n} from \"./lib/config.js\";\nimport open from \"open\";\nimport { Context, logMessage, oneoffContext } from \"../bundler/context.js\";\nimport { fetchTeamAndProject } from \"./lib/api.js\";\nimport { getConfiguredDeploymentOrCrash } from \"./lib/utils.js\";\n\nexport const dashboard = new Command(\"dashboard\")\n  .description(\"Open the dashboard in the browser\")\n  .option(\n    \"--no-open\",\n    \"Don't automatically open the dashboard in the default browser\"\n  )\n  .action(async (options) => {\n    const ctx = oneoffContext;\n    const configuredDeployment = await getConfiguredDeploymentOrCrash(ctx);\n    const loginUrl = await dashboardUrlForConfiguredDeployment(\n      ctx,\n      configuredDeployment\n    );\n\n    if (options.open) {\n      logMessage(\n        ctx,\n        chalk.gray(`Opening ${loginUrl} in the default browser...`)\n      );\n      await open(loginUrl);\n    } else {\n      console.log(loginUrl);\n    }\n  });\n\nexport async function dashboardUrlForConfiguredDeployment(\n  ctx: Context,\n  configuredDeployment: string | null\n): Promise<string> {\n  if (configuredDeployment !== null) {\n    const { team, project } = await fetchTeamAndProject(\n      ctx,\n      configuredDeployment\n    );\n    return dashboardUrl(team, project, configuredDeployment);\n  }\n  const { projectConfig } = await readProjectConfig(ctx);\n  return dashboardUrlForConfig(ctx, projectConfig);\n}\n\nasync function dashboardUrlForConfig(\n  ctx: Context,\n  projectConfig: ProjectConfig\n): Promise<string> {\n  const team = await enforceDeprecatedConfigField(ctx, projectConfig, \"team\");\n  const project = await enforceDeprecatedConfigField(\n    ctx,\n    projectConfig,\n    \"project\"\n  );\n  const prodUrl = await enforceDeprecatedConfigField(\n    ctx,\n    projectConfig,\n    \"prodUrl\"\n  );\n  const host = process.env.CONVEX_PROVISION_HOST\n    ? \"http://localhost:6789\"\n    : \"https://dashboard.convex.dev\";\n\n  // in local dev we don't know the deployment name\n  if (process.env.CONVEX_PROVISION_HOST) {\n    return host;\n  }\n\n  const deployment = prodUrl.match(/https?:\\/\\/([^.]*)[.]/)![1];\n  return dashboardUrl(team, project, deployment);\n}\n\nexport function dashboardUrl(\n  team: string,\n  project: string | null,\n  deploymentName: null\n): string;\nexport function dashboardUrl(\n  team: string,\n  project: string,\n  deploymentName: string | null\n): string;\nexport function dashboardUrl(\n  team: string,\n  project: string | null,\n  deploymentName: string | null\n) {\n  const host = process.env.CONVEX_PROVISION_HOST\n    ? \"http://localhost:6789\"\n    : \"https://dashboard.convex.dev\";\n  return `${host}/t/${team}${project !== null ? `/${project}` : \"\"}${\n    deploymentName !== null ? `/${deploymentName}` : \"\"\n  }`;\n}\n"],
  "mappings": ";AAAA,SAAS,eAAe;AACxB,OAAO,WAAW;AAClB;AAAA,EAEE;AAAA,EACA;AAAA,OACK;AACP,OAAO,UAAU;AACjB,SAAkB,YAAY,qBAAqB;AACnD,SAAS,2BAA2B;AACpC,SAAS,sCAAsC;AAExC,aAAM,YAAY,IAAI,QAAQ,WAAW,EAC7C,YAAY,mCAAmC,EAC/C;AAAA,EACC;AAAA,EACA;AACF,EACC,OAAO,OAAO,YAAY;AACzB,QAAM,MAAM;AACZ,QAAM,uBAAuB,MAAM,+BAA+B,GAAG;AACrE,QAAM,WAAW,MAAM;AAAA,IACrB;AAAA,IACA;AAAA,EACF;AAEA,MAAI,QAAQ,MAAM;AAChB;AAAA,MACE;AAAA,MACA,MAAM,KAAK,WAAW,oCAAoC;AAAA,IAC5D;AACA,UAAM,KAAK,QAAQ;AAAA,EACrB,OAAO;AACL,YAAQ,IAAI,QAAQ;AAAA,EACtB;AACF,CAAC;AAEH,sBAAsB,oCACpB,KACA,sBACiB;AACjB,MAAI,yBAAyB,MAAM;AACjC,UAAM,EAAE,MAAM,QAAQ,IAAI,MAAM;AAAA,MAC9B;AAAA,MACA;AAAA,IACF;AACA,WAAO,aAAa,MAAM,SAAS,oBAAoB;AAAA,EACzD;AACA,QAAM,EAAE,cAAc,IAAI,MAAM,kBAAkB,GAAG;AACrD,SAAO,sBAAsB,KAAK,aAAa;AACjD;AAEA,eAAe,sBACb,KACA,eACiB;AACjB,QAAM,OAAO,MAAM,6BAA6B,KAAK,eAAe,MAAM;AAC1E,QAAM,UAAU,MAAM;AAAA,IACpB;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACA,QAAM,UAAU,MAAM;AAAA,IACpB;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACA,QAAM,OAAO,QAAQ,IAAI,wBACrB,0BACA;AAGJ,MAAI,QAAQ,IAAI,uBAAuB;AACrC,WAAO;AAAA,EACT;AAEA,QAAM,aAAa,QAAQ,MAAM,uBAAuB,EAAG,CAAC;AAC5D,SAAO,aAAa,MAAM,SAAS,UAAU;AAC/C;AAYO,gBAAS,aACd,MACA,SACA,gBACA;AACA,QAAM,OAAO,QAAQ,IAAI,wBACrB,0BACA;AACJ,SAAO,GAAG,UAAU,OAAO,YAAY,OAAO,IAAI,YAAY,KAC5D,mBAAmB,OAAO,IAAI,mBAAmB;AAErD;",
  "names": []
}
